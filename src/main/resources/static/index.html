<!DOCTYPE html>
<html ng-app="ActivityMeterApp">
<head>
	<title>International University App</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<script
			src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.6/angular.min.js"></script>

	<script
			src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.1.0/ui-bootstrap-tpls.js"></script>

	<link
			href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css"
			rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="table.css" />

	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
	<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.light_blue-red.min.css" />
	<link rel="stylesheet" href="styles.css">
	<script>
        var app = angular.module('ActivityMeterApp', ['ui.bootstrap']);

        function loadActivities ($scope, $http){
            $http({
                method : 'GET',
				/*
				 url: (window.location.hostname === 'localhost' ?
				 'http://localhost:8080/activity' :
				 'https://activityexample.herokuapp.com/activity')
				 */
                url: 'activity'

            }).then(function (response) {
                $scope.activities = response.data;
            });
        }

        app.controller('ActivityCtrl', function ($scope, $http, $dialog) {

            loadActivities($scope, $http);


            var addDialogOptions = {
                controller: 'AddActivityCtrl',
                templateUrl: './activityAdd.html'
            };

            $scope.add = function(activity){
                $dialog.dialog(angular.extend(addDialogOptions, {})).open().then(function (){
                    loadActivities($scope, $http);
                }) ;
            };

            var editDialogOptions = {
                controller: 'EditActivityCtrl',
                templateUrl: './activityEdit.html',
            };
            $scope.edit = function(activity){
                var activityToEdit = activity;
                $dialog.dialog(angular.extend(editDialogOptions, {resolve: {activity: angular.copy(activityToEdit)}})).open().then(function (){
                    loadActivities($scope, $http);
                }) ;
            };

            $scope.delete = function(activity) {
                var deleteRequest = {
                    method : 'DELETE',
                    url: 'activity/' + activity.id
                };

                $http(deleteRequest).then(function() {
                    loadActivities($scope, $http);
                });
                //todo handle error
            };
        });
        app.controller('AddActivityCtrl', function($scope, $http, dialog){

            $scope.save = function(Activity) {
                var postRequest = {
                    method : 'POST',
                    url: 'activity' ,
                    data: {
                        text: $scope.activity.text,
                        tags: $scope.activity.tags,
                        title: $scope.activity.title
                    }
                }

                $http(postRequest).then(function (response) {
                    $scope.activities = response.data;
                }).then(function () {
                    $scope.close();
                });
            };

            $scope.close = function(){;
                dialog.close(undefined);
            };
        });
        app.controller('EditActivityCtrl', function ($scope, $http, activity, dialog) {

            $scope.activity = activity;
            $scope.save = function($activity) {
                var putRequest = {
                    method : 'PUT',
                    url: 'activity/' + $scope.activity.id,
                    data: {
                        text: $scope.activity.text,
                        tags: $scope.activity.tags,
                        title: $scope.activity.title
                    }
                }

                $http(putRequest).then(function (response) {
                    $scope.activities = response.data;
                }).then(function () {
                    //todo handle error
                    $scope.close();
                });
            };

            $scope.close = function(){
                loadActivities($scope, $http);
                dialog.close();
            };
        });
	</script>
</head>

<!-- Always shows a header, even in smaller screens. -->
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
	<header class="mdl-layout__header">
		<div class="mdl-layout__header-row">
			<!-- Title -->
			<span class="mdl-layout-title">IUA</span>
			<!-- Add spacer, to align navigation to the right -->
			<div class="mdl-layout-spacer"></div>
			<!-- Navigation. We hide it in small screens. -->
			<nav class="mdl-navigation mdl-layout--large-screen-only">
				<div class="searchBar">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" id="addr1">
						<label class="mdl-textfield__label" for="addr1">Search for...</label>
					</div>
				</div>
				<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
					Registration</button>
				<div style="padding-left: 20px">
					<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
						Login</button>
				</div>
			</nav>
		</div>
	</header>
	<div class="mdl-layout__drawer">
		<span class="mdl-layout-title">IUA</span>
		<nav class="mdl-navigation">
			<a class="mdl-navigation__link" href="">Link</a>
			<a class="mdl-navigation__link" href="">Link</a>
			<a class="mdl-navigation__link" href="">Link</a>
			<a class="mdl-navigation__link" href="">Link</a>
		</nav>
	</div>
	<main class="mdl-layout__content">
		<div style="margin-left: 20%">
			<div style="margin-top: 10%">
				<div class="page-content">
					<body>
					<div ng-controller="ActivityCtrl">
						<h3>Activities:</h3>
						<!-- Square card -->
						<style>
							.demo-card-square.mdl-card {
								width: 320px;
								height: 320px;
							}
							.demo-card-square > .mdl-card__title {
								color: #fff;
								background:
										bottom right 15% no-repeat #46B6AC;
							}
						</style>

						<div class="demo-card-square mdl-card mdl-shadow--2dp">
							<div class="mdl-card__title mdl-card--expand">
								<h2 class="mdl-card__title-text">{{activity.title}}</h2>
							</div>
							<div class="mdl-card__supporting-text">
								{{activity.text}}
							</div>
							<div class="mdl-card__actions mdl-card--border">
								<a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
									{{activity.tags}}
								</a>
							</div>
						</div>
						<table class="mdl-data-table">
							<tr>
								<td class="mdl-data-table__cell--non-numeric" colspan=3>&nbsp;</td>
								<td class="mdl-data-table__cell--non-numeric"><button
										class="mdl-button" ng-click="add()">add Activity</button></td>
							</tr>
							<tr ng-repeat="activity in activities">
								<!--<td class="mdl-data-table__cell&#45;&#45;non-numeric">{{activity.title}}</td>-->
								<!--<td class="mdl-data-table__cell&#45;&#45;non-numeric">{{activity.text}}</td>-->
								<!--<td class="mdl-data-table__cell&#45;&#45;non-numeric">{{activity.tags}}</td>-->
								<td class="mdl-data-table__cell--non-numeric">
									<button	class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" ng-click="edit(activity)">edit</button>
									<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" ng-click="delete(activity)">delete</button></td>
							</tr>
						</table>
					</div>
					</body>
				</div>
			</div>
		</div>
	</main>
</div>

</html>